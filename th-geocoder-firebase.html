<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../th-firebase/th-firebase.html">
<link rel="import" href="../th-geocoder/th-geocoder.html">

<!--
Element providing solution to no problem in particular.

##### Example

    <th-geocoder-firebase></th-geocoder-firebase>

@element th-geocoder-firebase
@blurb Element providing solution to no problem in particular.
@status alpha
@homepage http://polymerlabs.github.io/th-geocoder-firebase
-->
<polymer-element name="th-geocoder-firebase" attributes="input reverseGeocode firebaseDirectory firebaseLocationRequestRoute firebaseLocation">

  <template>
    <th-firebase id="firebase" directory="{{firebaseDirectory}}" locationRequestRoute="{{firebaseLocationRequestRoute}}" location="{{firebaseLocation}}" ></th-firebase>
    <th-geocoder id="geocoder" input="{{input | checkFirebase}}"></th-geocoder>
    akdjakd

  </template>

  <script>

    Polymer({
      
      ready: function() {
        var self = this;
        self.readyForInput = true;
        self.firebase = self.$.firebase;
        self.geocoder = self.$.geocoder;
        console.log("polymer ready");

        self.firebase.addEventListener('th-data-ready', function(response) {
            // Data found in firebase, so load into component
            console.log("data received");
            console.log(response.detail);
            // self.loadData(response.detail);
          });
        self.firebase.addEventListener('th-data-error', function(response) {
          // No data in firebase for that URL, so call parse
          console.log("not found");
          console.log(response.detail);
          // self.parseData(); 
        });
      },
      checkFirebase: function(value){
        var self = this;

        // This filter runs a split second before the ready callback, so created an interval to wait for it
        var waitForReady = setInterval(function(){
          if(self.readyForInput){
            console.log(value);
            
            self.firebase.load(value);
          
            clearInterval(waitForReady);
            return value;
          }
        },10)
        
      }

    });

  </script>

</polymer-element>
